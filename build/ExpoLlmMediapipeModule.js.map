{"version":3,"file":"ExpoLlmMediapipeModule.js","sourceRoot":"","sources":["../src/ExpoLlmMediapipeModule.ts"],"names":[],"mappings":"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","sourcesContent":["import { requireNativeModule } from \"expo-modules-core\";\nimport * as React from \"react\";\n\nimport type {\n  ExpoLlmMediapipeModule as NativeModuleType,\n  DownloadOptions,\n  DownloadProgressEvent,\n  UseLLMProps, // General type for dispatcher\n  BaseLlmReturn,\n  DownloadableLlmReturn,\n  UseLLMAssetProps,\n  UseLLMFileProps,\n  UseLLMDownloadableProps,\n  PartialResponseEventPayload,\n  ErrorResponseEventPayload,\n} from \"./ExpoLlmMediapipe.types\";\n\nconst module = requireNativeModule<NativeModuleType>(\"ExpoLlmMediapipe\");\n\n// Hook Overloads\nexport function useLLM(props: UseLLMDownloadableProps): DownloadableLlmReturn;\nexport function useLLM(props: UseLLMAssetProps): BaseLlmReturn;\nexport function useLLM(props: UseLLMFileProps): BaseLlmReturn;\n\n// Dispatcher Implementation\nexport function useLLM(props: UseLLMProps): BaseLlmReturn | DownloadableLlmReturn {\n  if ('modelUrl' in props && props.modelUrl !== undefined) {\n    return _useLLMDownloadable(props as UseLLMDownloadableProps);\n  } else {\n    return _useLLMBase(props as UseLLMAssetProps | UseLLMFileProps);\n  }\n}\n\n// Internal implementation for Downloadable models\nfunction _useLLMDownloadable(props: UseLLMDownloadableProps): DownloadableLlmReturn {\n  const [modelHandle, setModelHandle] = React.useState<number | undefined>();\n  const nextRequestIdRef = React.useRef(0);\n\n  const [downloadStatus, setDownloadStatus] = React.useState<\n    \"not_downloaded\" | \"downloading\" | \"downloaded\" | \"error\"\n  >(\"not_downloaded\");\n  const [downloadProgress, setDownloadProgress] = React.useState<number>(0);\n  const [downloadError, setDownloadError] = React.useState<string | null>(null);\n  const [isCheckingStatus, setIsCheckingStatus] = React.useState(true);\n\n  const { modelUrl, modelName, maxTokens, topK, temperature, randomSeed } = props;\n\n  React.useEffect(() => {\n    const checkModelStatus = async () => {\n      setIsCheckingStatus(true);\n      try {\n        const isDownloaded = await module.isModelDownloaded(modelName);\n        setDownloadStatus(isDownloaded ? \"downloaded\" : \"not_downloaded\");\n        if (isDownloaded) setDownloadProgress(1); else setDownloadProgress(0);\n      } catch (error) {\n        console.error(`Error checking model status for ${modelName}:`, error);\n        setDownloadError(error instanceof Error ? error.message : String(error));\n        setDownloadStatus(\"error\");\n      } finally {\n        setIsCheckingStatus(false);\n      }\n    };\n    checkModelStatus();\n  }, [modelName]);\n\n  React.useEffect(() => {\n    const subscription = module.addListener(\n      \"downloadProgress\",\n      (event: DownloadProgressEvent) => {\n        if (event.modelName !== modelName) return;\n\n        if (event.status === \"downloading\" && event.progress !== undefined) {\n          setDownloadProgress(event.progress);\n          setDownloadStatus(\"downloading\");\n        } else if (event.status === \"completed\") {\n          setDownloadProgress(1);\n          setDownloadStatus(\"downloaded\");\n          setDownloadError(null);\n        } else if (event.status === \"error\") {\n          setDownloadStatus(\"error\");\n          setDownloadError(event.error || \"Unknown error occurred\");\n        } else if (event.status === \"cancelled\") {\n          setDownloadStatus(\"not_downloaded\");\n          setDownloadProgress(0);\n        }\n      },\n    );\n    return () => subscription.remove();\n  }, [modelName]);\n\n  React.useEffect(() => {\n    const currentModelHandle = modelHandle;\n    return () => {\n      if (currentModelHandle !== undefined) {\n        console.log(`Releasing downloadable model with handle ${currentModelHandle}.`);\n        module.releaseModel(currentModelHandle)\n          .then(() => console.log(`Successfully released model ${currentModelHandle}`))\n          .catch((error) => console.error(`Error releasing model ${currentModelHandle}:`, error));\n      }\n    };\n  }, [modelHandle]);\n\n  const downloadModelHandler = React.useCallback(\n    async (options?: DownloadOptions): Promise<boolean> => {\n      try {\n        setDownloadStatus(\"downloading\");\n        setDownloadProgress(0);\n        setDownloadError(null);\n        const result = await module.downloadModel(modelUrl, modelName, options);\n        return result;\n      } catch (error) {\n        console.error(`Error initiating download for ${modelName}:`, error);\n        setDownloadStatus(\"error\");\n        setDownloadError(error instanceof Error ? error.message : String(error));\n        throw error;\n      }\n    },\n    [modelUrl, modelName],\n  );\n\n  const loadModelHandler = React.useCallback(async (): Promise<void> => {\n    if (modelHandle !== undefined) {\n      console.log(`Model ${modelName} already loaded or load in progress.`);\n      return;\n    }\n    if (downloadStatus !== \"downloaded\") {\n      throw new Error(`Model ${modelName} is not downloaded. Call downloadModel() first.`);\n    }\n    try {\n      console.log(`Attempting to load downloaded model: ${modelName}`);\n      const handle = await module.createModelFromDownloaded(\n        modelName,\n        maxTokens ?? 512,\n        topK ?? 40,\n        temperature ?? 0.8,\n        randomSeed ?? 0,\n      );\n      console.log(`Loaded downloaded model '${modelName}' with handle ${handle}`);\n      setModelHandle(handle);\n    } catch (error) {\n      console.error(`Error loading downloaded model '${modelName}':`, error);\n      setModelHandle(undefined);\n      throw error;\n    }\n  }, [modelHandle, downloadStatus, modelName, maxTokens, topK, temperature, randomSeed]);\n\n  const generateResponse = React.useCallback(\n    async (\n      promptText: string,\n      onPartial?: (partial: string, reqId: number | undefined) => void,\n      onErrorCb?: (message: string, reqId: number | undefined) => void,\n      abortSignal?: AbortSignal,\n    ): Promise<string> => {\n      if (modelHandle === undefined) {\n        throw new Error(\"Model is not loaded. Call loadModel() first.\");\n      }\n      const requestId = nextRequestIdRef.current++;\n\n      const partialSub = module.addListener(\"onPartialResponse\", (ev: PartialResponseEventPayload) => {\n        if (onPartial && requestId === ev.requestId && ev.handle === modelHandle && !(abortSignal?.aborted ?? false)) {\n          onPartial(ev.response, ev.requestId);\n        }\n      });\n      const errorSub = module.addListener(\"onErrorResponse\", (ev: ErrorResponseEventPayload) => {\n        if (onErrorCb && requestId === ev.requestId && ev.handle === modelHandle && !(abortSignal?.aborted ?? false)) {\n          onErrorCb(ev.error, ev.requestId);\n        }\n      });\n\n      try {\n        return await module.generateResponse(modelHandle, requestId, promptText);\n      } catch (e) {\n        console.error(\"Generate response error:\", e);\n        if (onErrorCb && !(abortSignal?.aborted ?? false)) {\n          onErrorCb(e instanceof Error ? e.message : String(e), requestId);\n        }\n        throw e;\n      } finally {\n        partialSub.remove();\n        errorSub.remove();\n      }\n    },\n    [modelHandle]\n  );\n\n  const generateStreamingResponse = React.useCallback(\n    async (\n      promptText: string,\n      onPartial?: (partial: string, reqId: number) => void,\n      onErrorCb?: (message: string, reqId: number) => void,\n      abortSignal?: AbortSignal,\n    ): Promise<void> => {\n      if (modelHandle === undefined) {\n        throw new Error(\"Model is not loaded. Call loadModel() first.\");\n      }\n      const requestId = nextRequestIdRef.current++;\n\n      return new Promise<void>((resolve, reject) => {\n        const partialSubscription = module.addListener(\"onPartialResponse\", (ev: PartialResponseEventPayload) => {\n          if (ev.handle === modelHandle && ev.requestId === requestId && !(abortSignal?.aborted ?? false)) {\n            if (onPartial) onPartial(ev.response, ev.requestId);\n          }\n        });\n        const errorSubscription = module.addListener(\"onErrorResponse\", (ev: ErrorResponseEventPayload) => {\n          if (ev.handle === modelHandle && ev.requestId === requestId && !(abortSignal?.aborted ?? false)) {\n            if (onErrorCb) onErrorCb(ev.error, ev.requestId);\n            errorSubscription.remove();\n            partialSubscription.remove();\n            reject(new Error(ev.error));\n          }\n        });\n\n        if (abortSignal) {\n          abortSignal.addEventListener('abort', () => {\n            errorSubscription.remove();\n            partialSubscription.remove();\n            console.log(`Request ${requestId} aborted for downloadable model.`);\n            reject(new Error(\"Aborted\"));\n          });\n        }\n\n        module.generateResponseAsync(modelHandle, requestId, promptText)\n          .then(() => {\n            if (!(abortSignal?.aborted ?? false)) {\n              errorSubscription.remove();\n              partialSubscription.remove();\n              resolve();\n            }\n          })\n          .catch((error) => {\n            if (!(abortSignal?.aborted ?? false)) {\n              errorSubscription.remove();\n              partialSubscription.remove();\n              if (onErrorCb) {\n                onErrorCb(error instanceof Error ? error.message : String(error), requestId);\n              }\n              reject(error);\n            }\n          });\n      });\n    },\n    [modelHandle]\n  );\n\n  return React.useMemo(() => ({\n    generateResponse,\n    generateStreamingResponse,\n    isLoaded: modelHandle !== undefined,\n    downloadModel: downloadModelHandler,\n    loadModel: loadModelHandler,\n    downloadStatus,\n    downloadProgress,\n    downloadError,\n    isCheckingStatus,\n  }), [\n    generateResponse, generateStreamingResponse, modelHandle,\n    downloadModelHandler, loadModelHandler, downloadStatus, downloadProgress, downloadError, isCheckingStatus,\n  ]);\n}\n\n// Internal implementation for Asset/File models\nfunction _useLLMBase(props: UseLLMAssetProps | UseLLMFileProps): BaseLlmReturn {\n  const [modelHandle, setModelHandle] = React.useState<number | undefined>();\n  const nextRequestIdRef = React.useRef(0);\n\n  const { maxTokens, topK, temperature, randomSeed } = props;\n  let modelIdentifier: string | undefined;\n  let storageType: \"asset\" | \"file\" | undefined;\n\n  if (props.storageType === 'asset') {\n    modelIdentifier = props.modelName;\n    storageType = props.storageType;\n  } else if (props.storageType === 'file') {\n    modelIdentifier = props.modelPath;\n    storageType = props.storageType;\n  }\n\n  React.useEffect(() => {\n    if (!storageType || !modelIdentifier) {\n      if (modelHandle !== undefined) setModelHandle(undefined);\n      return;\n    }\n\n    const currentConfigStorageKey = modelIdentifier;\n    const currentStorageType = storageType;\n    \n    console.log(`Attempting to create non-downloadable model: ${currentConfigStorageKey}, type: ${currentStorageType}`);\n    \n    let active = true;\n    const modelCreatePromise =\n      currentStorageType === \"asset\"\n        ? module.createModelFromAsset(currentConfigStorageKey, maxTokens ?? 512, topK ?? 40, temperature ?? 0.8, randomSeed ?? 0)\n        : module.createModel(currentConfigStorageKey, maxTokens ?? 512, topK ?? 40, temperature ?? 0.8, randomSeed ?? 0);\n\n    modelCreatePromise\n      .then((handle: number) => {\n        if (active) {\n          console.log(`Created non-downloadable model with handle ${handle} for ${currentConfigStorageKey}`);\n          setModelHandle(handle);\n        } else {\n          module.releaseModel(handle).catch(e => console.error(\"Error releasing model from stale promise (non-downloadable)\", e));\n        }\n      })\n      .catch((error: Error) => {\n        if (active) {\n          console.error(`createModel error for ${currentConfigStorageKey} (non-downloadable):`, error);\n          setModelHandle(undefined);\n        }\n      });\n\n    return () => {\n      active = false;\n    };\n  }, [modelIdentifier, storageType, maxTokens, topK, temperature, randomSeed]);\n\n  React.useEffect(() => {\n    const currentModelHandle = modelHandle;\n    return () => {\n      if (currentModelHandle !== undefined) {\n        console.log(`Releasing base model with handle ${currentModelHandle}.`);\n        module.releaseModel(currentModelHandle)\n          .then(() => console.log(`Successfully released model ${currentModelHandle}`))\n          .catch((error) => console.error(`Error releasing model ${currentModelHandle}:`, error));\n      }\n    };\n  }, [modelHandle]);\n\n  const generateResponse = React.useCallback(\n    async (\n      promptText: string,\n      onPartial?: (partial: string, reqId: number | undefined) => void,\n      onErrorCb?: (message: string, reqId: number | undefined) => void,\n      abortSignal?: AbortSignal,\n    ): Promise<string> => {\n      if (modelHandle === undefined) {\n        throw new Error(\"Model handle is not defined. Ensure model is created/loaded.\");\n      }\n      const requestId = nextRequestIdRef.current++;\n\n      const partialSub = module.addListener(\"onPartialResponse\", (ev: PartialResponseEventPayload) => {\n        if (onPartial && requestId === ev.requestId && ev.handle === modelHandle && !(abortSignal?.aborted ?? false)) {\n          onPartial(ev.response, ev.requestId);\n        }\n      });\n      const errorSub = module.addListener(\"onErrorResponse\", (ev: ErrorResponseEventPayload) => {\n        if (onErrorCb && requestId === ev.requestId && ev.handle === modelHandle && !(abortSignal?.aborted ?? false)) {\n          onErrorCb(ev.error, ev.requestId);\n        }\n      });\n\n      try {\n        return await module.generateResponse(modelHandle, requestId, promptText);\n      } catch (e) {\n        console.error(\"Generate response error:\", e);\n        if (onErrorCb && !(abortSignal?.aborted ?? false)) {\n          onErrorCb(e instanceof Error ? e.message : String(e), requestId);\n        }\n        throw e;\n      } finally {\n        partialSub.remove();\n        errorSub.remove();\n      }\n    },\n    [modelHandle]\n  );\n\n  const generateStreamingResponse = React.useCallback(\n    async (\n      promptText: string,\n      onPartial?: (partial: string, reqId: number) => void,\n      onErrorCb?: (message: string, reqId: number) => void,\n      abortSignal?: AbortSignal,\n    ): Promise<void> => {\n      if (modelHandle === undefined) {\n        throw new Error(\"Model handle is not defined. Ensure model is created/loaded.\");\n      }\n      const requestId = nextRequestIdRef.current++;\n\n      return new Promise<void>((resolve, reject) => {\n        const partialSubscription = module.addListener(\"onPartialResponse\", (ev: PartialResponseEventPayload) => {\n          if (ev.handle === modelHandle && ev.requestId === requestId && !(abortSignal?.aborted ?? false)) {\n            if (onPartial) onPartial(ev.response, ev.requestId);\n          }\n        });\n        const errorSubscription = module.addListener(\"onErrorResponse\", (ev: ErrorResponseEventPayload) => {\n          if (ev.handle === modelHandle && ev.requestId === requestId && !(abortSignal?.aborted ?? false)) {\n            if (onErrorCb) onErrorCb(ev.error, ev.requestId);\n            errorSubscription.remove();\n            partialSubscription.remove();\n            reject(new Error(ev.error));\n          }\n        });\n\n        if (abortSignal) {\n          abortSignal.addEventListener('abort', () => {\n            errorSubscription.remove();\n            partialSubscription.remove();\n            console.log(`Request ${requestId} aborted for base model.`);\n            reject(new Error(\"Aborted\"));\n          });\n        }\n\n        module.generateResponseAsync(modelHandle, requestId, promptText)\n          .then(() => {\n            if (!(abortSignal?.aborted ?? false)) {\n              errorSubscription.remove();\n              partialSubscription.remove();\n              resolve();\n            }\n          })\n          .catch((error) => {\n            if (!(abortSignal?.aborted ?? false)) {\n              errorSubscription.remove();\n              partialSubscription.remove();\n              if (onErrorCb) {\n                onErrorCb(error instanceof Error ? error.message : String(error), requestId);\n              }\n              reject(error);\n            }\n          });\n      });\n    },\n    [modelHandle]\n  );\n\n  return React.useMemo(() => ({\n    generateResponse,\n    generateStreamingResponse,\n    isLoaded: modelHandle !== undefined,\n  }), [generateResponse, generateStreamingResponse, modelHandle]);\n}\n\n\n/**\n * Generate a streaming text response from the LLM.\n * This is an independent utility function.\n */\nexport function generateStreamingText(\n  modelHandle: number,\n  prompt: string,\n  onPartialResponse?: (text: string, requestId: number) => void,\n  onError?: (error: string, requestId: number) => void,\n  abortSignal?: AbortSignal,\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if (!modelHandle && modelHandle !== 0) { // modelHandle can be 0\n      reject(new Error(\"Invalid model handle provided to generateStreamingText.\"));\n      return;\n    }\n\n    const requestId = Math.floor(Math.random() * 1000000); // Increased range for uniqueness\n\n    const partialSubscription = module.addListener(\n      \"onPartialResponse\",\n      (ev: PartialResponseEventPayload) => {\n        if (\n          ev.handle === modelHandle &&\n          ev.requestId === requestId &&\n          !(abortSignal?.aborted ?? false)\n        ) {\n          if (onPartialResponse) {\n            onPartialResponse(ev.response, ev.requestId);\n          }\n        }\n      },\n    );\n\n    const errorSubscription = module.addListener(\n      \"onErrorResponse\",\n      (ev: ErrorResponseEventPayload) => {\n        if (\n          ev.handle === modelHandle &&\n          ev.requestId === requestId &&\n          !(abortSignal?.aborted ?? false)\n        ) {\n          if (onError) {\n            onError(ev.error, ev.requestId);\n          }\n          errorSubscription.remove();\n          partialSubscription.remove();\n          reject(new Error(ev.error));\n        }\n      },\n    );\n\n    if (abortSignal) {\n      abortSignal.addEventListener('abort', () => {\n        // Check if subscriptions still exist before removing\n        // This is a defensive check, as they might have been removed by completion/error\n        try {\n            partialSubscription.remove();\n        } catch (subError) {\n            // console.warn(\"generateStreamingText: Error removing partialSubscription on abort:\", subError);\n        }\n        try {\n            errorSubscription.remove();\n        } catch (subError) {\n            // console.warn(\"generateStreamingText: Error removing errorSubscription on abort:\", subError);\n        }\n        console.log(`generateStreamingText Request ${requestId} aborted.`);\n        reject(new Error(\"Aborted\"));\n      });\n    }\n\n    module\n      .generateResponseAsync(modelHandle, requestId, prompt)\n      .then(() => {\n        if (!(abortSignal?.aborted ?? false)) {\n          partialSubscription.remove();\n          errorSubscription.remove();\n          resolve();\n        }\n        // If aborted, the abort listener should have handled rejection and cleanup.\n      })\n      .catch((error) => {\n        if (!(abortSignal?.aborted ?? false)) {\n          partialSubscription.remove();\n          errorSubscription.remove();\n          if (onError) {\n            onError(error instanceof Error ? error.message : String(error), requestId);\n          }\n          reject(error);\n        }\n        // If aborted, the abort listener should have handled rejection and cleanup.\n      });\n  });\n}\n\nexport default module;\n"]}